vivaxGEN Installation Script Collection
=======================================

Quick Start
-----------

For vivaxGEN `ngs-pipeline <https://github.com/vivaxgen/ngs-pipeline>`_,
install with the following command::

    "${SHELL}" <(curl -L https://raw.githubusercontent.com/vivaxgen/install/main/ngs-pl.sh)

For `SRA Repo <https://github.com/vivaxgen/sra-repo>`_, install with the
following command::

    "${SHELL}" <(curl -L https://raw.githubusercontent.com/vivaxgen/install/main/sra-repo.sh)

For `G6PD amplicon sequencing pipeline <https://github.com/vivaxgen/G6PD_MinION>`_,
install with the following command::

    "${SHELL}" <(curl -L https://raw.githubusercontent.com/vivaxgen/install/main/G6PD-pl.sh)

For vivaxGEN `MicroHaps sequencing pipeline <https://github.com/vivaxgen/MicroHaps>`_,
install with the following command::

    "${SHELL}" <(curl -L https://raw.githubusercontent.com/vivaxgen/install/main/MicroHaps-pl.sh)

The base can be installed using the following command::

    "${SHELL}" <(curl -L https://raw.githubusercontent.com/vivaxgen/install/main/MicroHaps-pl.sh)


Quick Overview
--------------

This repo contains install scripts for software packages (such as various
pipelines) that use micromamba to provide all binary dependencies.
No configuration or setting files will be left on the home directory of the
users who execute the install scripts (apart from download cache of micromamba
in ~/.cache directory that can be removed manually, and addition of the
environment directory at ~/.conda/environment.txt, if ~/.conda/environment.txt
is already existed, which can also be deleted manually).

The following is base structure of the directories generated by base.sh,
assuming that VVG_BASEDIR is the base directory of the installation::

    VVG_BASEDIR/
                bin/
                    activate.sh
                    micromamba
                    update-pipeline.sh
                opt/
                    umamba/
                    apptainer/
                envs/
                etc/
                    bashrc
                    bashrc.d/
                    snakemake-profiles/

``bin/activate.sh``
  The main dual activation/source script. If the script is executed, then a
  new shell will be initiated (which then can be sxited), while if the script
  is being sourced, the current shell will remain.

``bin/micromamba``
  The micromamba executable binary.

``bin/update-pipeline.sh``
  A script that will traverse to each directory under ``$VVG_BASEDIR/envs/``
  and perform a ``git pull``.

``opt/umamba/``
  The directory to hold micromamba environments and packages.

``opt/apptainer/``
  The directory to hold any apptainer/singularity images.

``envs/``
  The directory to hold the pipeline environments and/or the software packages.

``etc/bashrc``
  The main source script which needed to be source first before using the
  installed software package, and performs the following:

  - export ``$VVG_BASEDIR`` environment variable with the VVG_BASEDIR

  - add ``$VVG_BASEDIR/bin/`` to PATH

  - set ``$MAMBA_ROOT_PREFIX`` to ``$VVG_BASEDIR/opt/umamba``

  - set ``$APPTAINER_DIR`` to ``$VVG_BASEDIR/opt/apptainer`` to hold any apptainer
    images (if required)

  - prepare and activate the required micromamba environment

  - source any bashrc file in ``$VVG_BASEDIR/etc/bashrc.d/`` in alphabetical order

``etc/bashrc.d/``
  Directory containing bash resource files to be sourced in alphabetical order
  when ``etc/bashrc`` is being sourced.
  Software package's specific activation source file should be put inside this
  directory.

  The activation source file name should be prefixed with 2-digit and dash, eg
  for vivaxGEN NGS-Pipeline, the source file is ``10-ngs-pipeline``.
  Other pipelines and software packages that rely on vivaxGEN NGS-Pipeline
  should use number starting from ``50-``.
  Other global settings that can be modified by users should use number
  starting from ``90-``, eg. the snakemake job scheduler profile setting is
  ``99-snakemake-profiles``.

``etc/snakemake-profiles/``
  The directory for holding the snakemake profiles related to job scheduler,
  eg. profiles related to slurm.

